#!/bin/bash

clear

# some newbie validations.
if ! command -v xwininfo >/dev/null 2>&1; then
  echo "[ERRO] xwininfo não está instalado."
  echo "→ Instale com: sudo apt install x11-utils"
  exit 1
fi

if ! command -v wmctrl >/dev/null 2>&1; then
  echo "[ERRO] wmctrl não está instalado."
  echo "→ Instale com: sudo apt install wmctrl"
  exit 1
fi

# Obter resolução da tela
RES=$(xwininfo -root | awk '/Width|Height/ {print $2}' | xargs)
WIDTH=$(echo $RES | cut -d' ' -f1)
HEIGHT=$(echo $RES | cut -d' ' -f2)

# Exportar variáveis
export WIDTH HEIGHT

# Obter nome do gerenciador de janelas
WM=$(wmctrl -m | awk -F: '/Name/ {print $2}' | xargs)
export WM

# Exibir informações detectadas
echo ""
echo "gr4ph: $WM"

# Definir prefixo para zenity, se necessário
if [[ "$WM" == "Fluxbox" ]]; then
  export ZENITY_CMD="GDK_BACKEND=x11 zenity"
else
  export ZENITY_CMD="zenity"
fi

# Exemplo de uso do zenity com prefixo detectado
# $ZENITY_CMD --info --text="Ambiente gráfico detectado corretamente."


check_resolution() {
  if ! command -v xwininfo &> /dev/null; then
    echo "O utilitário 'xwininfo' não está instalado."
    echo "ℹ️  Para instalar no Debian/Ubuntu, execute:"
    echo "    sudo apt-get update && sudo apt-get install x11-utils"
    return 1
  fi

  RESOLUTION=$(xwininfo -stats -root | grep 'Width\|Height' | awk '{print $2}')
  WIDTH=$(echo "$RESOLUTION" | sed -n 1p)
  HEIGHT=$(echo "$RESOLUTION" | sed -n 2p)

  export WIDTH
  export HEIGHT

  echo "m0n: ${WIDTH}x${HEIGHT}"
}

#
# Resolution Support.
#
# * xwininfo -stats -root
#
#prepare_gui_environment
check_resolution

#
# Shell hardening, Signal trapping e handling, Interactive shell locking and Secure restricted shell.
#
hakuna() {
    # Trap de signals para bloquear interrupções comuns.
    trap '' SIGINT    # Bloqueia Ctrl+C.
    trap '' SIGTSTP   # Bloqueia Ctrl+Z.
    trap '' SIGQUIT   # Bloqueia Ctrl+\.
    trap '' SIGTERM   # Bloqueia encerramentos via kill.

    while true; do
     read -rp "armx > " ID
        # Verifica se a variável contém apenas letras (sem números ou símbolos).
        if [[ "$ID" =~ ^[a-zA-Z]+$ ]]; then
            break
        else
            echo "[INFO]: Digite 'help ou ?' para obter informações."
        fi
    done

    # Restaura sinais se necessário
    trap - SIGINT SIGTSTP SIGQUIT SIGTERM
}

#
# Manual Resolution Support.
#
# * Example to obtain your resolution using the command above.
#
# > xwininfo -stats -root
#
# WIDTH=1920";
# HEIGHT=1080";

#
# ARM Compiler.
#
# * https://mirrors.edge.kernel.org/pub/tools/crosstool
# * https://mirrors.edge.kernel.org/pub/tools/crosstool/files/bin/x86_64/11.1.0/
#
MIRROR_LINARO="https://releases.linaro.org/components/toolchain/binaries/";
HARD_FLOAT="/arm-linux-gnueabihf/";
HARD_FLOAT_ARCH='*x86.*_arm-linux-gnueabihf.tar.xz"';
GCC_BUILD_NAME="code-compiler"

#
# Bootloader.
#
# * https://gitlab.com/u-boot/u-boot.git
# * https://source.denx.de/u-boot/u-boot
# * https://git.beagleboard.org/beagleboard/u-boot.git
#
MIRROR_UBOOT="https://gitlab.com/u-boot/u-boot.git"
UBOOT_BUILD_NAME="code-uboot"

#
# Kernel.
#
# * https://github.com/RobertCNelson/bb-kernel
# * https://github.com/torvalds/linux
# * https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git
#
MIRROR_KERNEL="https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git"
KERNEL_BUILD_NAME="code-kernel"

#
# Root File System.
#
# * https://rcn-ee.com/rootfs/eewiki/minfs/
#
MIRROR_FS="https://dl-cdn.alpinelinux.org/alpine/v3.16/releases/armhf/"
RTFS_BUILD_NAME="src-rootfs"

# protect shell! or not kkkk
echo -e ">>> armx-tool <<<\n*** “The first rule of the ninja is to do no harm. Unless you mean to do harm, then do lots of harm.”"
hakuna
