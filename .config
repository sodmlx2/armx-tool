#!/bin/bash

# armx config file.

clear

export GDK_BACKEND=x11

# some newbie validations.
if ! command -v xwininfo >/dev/null 2>&1; then
  echo "[ERROR] xwininfo is not found!"
  exit 1
fi

if ! command -v wmctrl >/dev/null 2>&1; then
  echo "[ERROR] wmctrl is not found!"
  exit 1
fi

#
# Manual Resolution Support.
# WIDTH="800";
# HEIGHT="600";
# export WIDTH HEIGHT
#

# get windows manager type.
WM=$(wmctrl -m | awk -F: '/Name/ {print $2}' | xargs)
export WM

echo -e "\ngr4ph: $WM"

# fluxbox.
if [[ "$WM" == "Fluxbox" ]]; then
  export ZENITY_CMD="GDK_BACKEND=x11 zenity"
else
  export ZENITY_CMD="zenity"
fi

# resolution discovery.
check_resolution() {
  if ! command -v xwininfo &> /dev/null; then
    echo "[ERROR] O utilitário 'xwininfo' não está instalado!"
    return 1
  fi

  RESOLUTION=$(xwininfo -stats -root | grep 'Width\|Height' | awk '{print $2}')
  WIDTH=$(echo "$RESOLUTION" | sed -n 1p)
  HEIGHT=$(echo "$RESOLUTION" | sed -n 2p)
  
  export WIDTH
  export HEIGHT

  echo -e "\nm0n: ${WIDTH}x${HEIGHT}\n"
}

# Resolution Auto.
check_resolution

# Shell hardening, Signal trapping e handling, Interactive shell locking and Secure restricted shell.
hakuna() {
    # Trap de signals para bloquear interrupções comuns.
    trap '' SIGINT    # Bloqueia Ctrl+C.
    trap '' SIGTSTP   # Bloqueia Ctrl+Z.
    trap '' SIGQUIT   # Bloqueia Ctrl+\.
    trap '' SIGTERM   # Bloqueia encerramentos via kill.

    while true; do
     read -rp "armx > " ID
        # Verifica se a variável contém apenas letras (sem números ou símbolos).
        if [[ "$ID" =~ ^[a-zA-Z]+$ ]]; then
            break
        else
            echo "[INFO]: Digite 'help ou ?' para obter informações."
        fi
    done

    # Restaura sinais se necessário.
    trap - SIGINT SIGTSTP SIGQUIT SIGTERM
}

#
# * Compiler.
# 
# * https://mirrors.edge.kernel.org/pub/tools/crosstool
# * https://mirrors.edge.kernel.org/pub/tools/crosstool/files/bin/x86_64/11.1.0/
# * https://releases.linaro.org/components/toolchain/binaries/ deadly ;
# 

https://developer.arm.com/downloads/-/gnu-rm
MIRROR_LINARO="https://releases.linaro.org/components/toolchain/binaries/";
HARD_FLOAT="/arm-linux-gnueabihf/";
HARD_FLOAT_ARCH='x86.*_arm-linux-gnueabihf.tar.xz"';
GCC_BUILD_NAME="code-compiler"

#
# * Bootloader.
#
# * https://gitlab.com/u-boot/u-boot.git
# * https://source.denx.de/u-boot/u-boot
# * https://git.beagleboard.org/beagleboard/u-boot.git
#
MIRROR_UBOOT="https://gitlab.com/u-boot/u-boot.git"
UBOOT_BUILD_NAME="code-uboot"

#
# * Kernel.
#
# * https://github.com/RobertCNelson/bb-kernel
# * https://github.com/torvalds/linux
# * https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git
#
MIRROR_KERNEL="https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git"
KERNEL_BUILD_NAME="code-kernel"

#
# * Root File System.
#
# * https://rcn-ee.com/rootfs/eewiki/minfs/
#
MIRROR_FS="https://dl-cdn.alpinelinux.org/alpine/v3.16/releases/armhf/"
RTFS_BUILD_NAME="src-rootfs"

# shell!
hakuna
